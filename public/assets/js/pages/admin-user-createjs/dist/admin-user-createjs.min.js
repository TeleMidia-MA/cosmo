function frmCreateUser(){}frmCreateUser.prototype.initialize=function(){$("#btn-create-user").on("click",function(){return cosmo.frmcreateuser.validate()&&cosmo.frmcreateuser.save(),!1}),$("#btn-alter-image").click(function(){cosmo.frmcreateuser.wrapImage()}),$("#input-frmuser-fileupload").on("change",function(){cosmo.frmcreateuser.loadAvatar()})},frmCreateUser.prototype.createObject=function(){var e={};return e.avatar=$("#img-frmuser-avatar").attr("src"),e.fullname=$("#input-frmuser-name").val(),e.username=$("#input-frmuser-email").val(),e.password=$("#input-frmuser-password").val(),e.admin=$("input#input-frmuser-administrator:checked").length,e},frmCreateUser.prototype.wrapImage=function(){$("#input-frmuser-fileupload").click()},frmCreateUser.prototype.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},frmCreateUser.prototype.validateUsername=function(e){var r=!1;if(!this.validateEmail(e))return!1;var a="username="+e,o=function(){r=!0},t=function(e){cosmo.dialog.error("Erro",e.responseJSON[0]),r=!1},i=cosmo.ajax.getDefaults();return i.url=cosmo.urlbase+cosmo.routes_name.AVALIABLE_USERNAME_COSMO,i.method="GET",i.data=a,i.type="json",i.async=!1,i.sucess=o,i.error=t,cosmo.ajax.send(i),r},frmCreateUser.prototype.validate=function(){var e=this.createObject();return""===e.username.trim()?(cosmo.dialog.error("Erro","O campo Email é obrigatório!"),!1):this.validateEmail(e.username)?!!this.validateUsername(e.username)&&(""===e.fullname.trim()?(cosmo.dialog.error("Erro","O campo Nome Completo é obrigatório!"),!1):""===e.password.trim()?(cosmo.dialog.error("Erro","O campo Senha é obrigatório!"),!1):e.password.length<=3?(cosmo.dialog.error("Erro","O campo Senha deve possuir mais do que 3 caracteres!"),!1):!!this.isDataURL(e.avatar)||(cosmo.dialog.error("Erro","O campo Imagem é obrigatório!"),!1)):(cosmo.dialog.error("Erro","O campo Email informado é inválido!"),!1)},frmCreateUser.prototype.loadAvatar=function(){var e=new FileReader,r=/^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i,a=$("#input-frmuser-fileupload").get(0).files[0];if(!r.test(a.type))return void cosmo.dialog.error("Erro","O arquivo selecionado é inválido.");e.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=function(){var e=document.createElement("canvas");e.width=96,e.height=96,e.getContext("2d").drawImage(this,0,0,100,100),$("#img-frmuser-avatar").attr("src",e.toDataURL())},r.src=e.target.result},0!==$("#input-frmuser-fileupload").get(0).files.length&&e.readAsDataURL(a)},frmCreateUser.prototype.isDataURL=function(e){var r=/^\s*data:([a-z]+\/[a-z0-9\-\+]+(;[a-z\-]+\=[a-z0-9\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;return!!e.match(r)},frmCreateUser.prototype.save=function(){var e=this.createObject(),r=function(e){cosmo.dialog.success("Cadastro de usuário!",e.message,function(){window.location.href=e.callback})},a=function(e){cosmo.dialog.error("Erro",e.responseJSON[0])},o=cosmo.ajax.getDefaults();return o.url=cosmo.urlbase+cosmo.routes_name.ADM_REGISTER_USER_SAVE,o.method="POST",o.data=e,o.type="json",o.sucess=r,o.error=a,cosmo.ajax.send(o),!0},window.cosmo=window.cosmo||{},window.cosmo.frmcreateuser=window.cosmo.frmcreateuser||new frmCreateUser,$("document").ready(function(){window.cosmo.frmcreateuser.initialize()});